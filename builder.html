<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design Studio Pro | Resume Builder</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --bg-primary: #09090b;
      --bg-secondary: #0a0a0a;
      --bg-card: rgba(255,255,255,0.03);
      --border: rgba(255,255,255,0.1);
      --text-primary: #fafafa;
      --text-secondary: #a1a1aa;
      --accent: #3b82f6;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* Header */
    header {
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 12px 24px;
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
    }
    
    .logo-icon {
      width: 32px;
      height: 32px;
      background: var(--accent);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 11px;
    }
    
    .header-actions {
      display: flex;
      gap: 8px;
    }
    
    button {
      font-family: inherit;
      font-size: 13px;
      font-weight: 500;
      padding: 8px 14px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.15s ease;
    }
    
    button:hover { background: rgba(255,255,255,0.05); }
    button.primary { background: var(--accent); border-color: var(--accent); }
    button.primary:hover { background: #2563eb; }
    button.danger { border-color: #dc2626; color: #f87171; }
    button.danger:hover { background: rgba(220,38,38,0.1); }
    
    /* Main Layout */
    main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    
    /* Sidebars */
    .sidebar {
      width: 360px;
      border-right: 1px solid var(--border);
      overflow-y: auto;
      background: var(--bg-secondary);
      padding: 20px;
    }
    
    .sidebar-right {
      width: 280px;
      border-left: 1px solid var(--border);
      border-right: none;
      padding: 24px;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 4px;
      background: rgba(255,255,255,0.05);
      padding: 4px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .tab {
      flex: 1;
      padding: 10px;
      border: none;
      background: transparent;
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    
    .tab.active {
      background: var(--accent);
      color: white;
    }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    /* Form Elements */
    .section-header {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--accent);
      margin: 20px 0 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .section-header:first-child { margin-top: 0; }
    
    label {
      display: block;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 10px 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 13px;
      margin-bottom: 10px;
      transition: border-color 0.15s ease;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    textarea { resize: vertical; min-height: 80px; }
    
    select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23a1a1aa' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    }
    
    select option {
      background: #1a1a1a;
      color: #fafafa;
      padding: 10px;
    }
    
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .grid-2 input, .grid-2 select { margin-bottom: 0; }
    
    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px;
      margin-bottom: 12px;
      position: relative;
      cursor: grab;
    }
    
    .card:active { cursor: grabbing; }
    
    .card.dragging { opacity: 0.5; }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .card .remove-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      padding: 0;
      border: none;
      background: transparent;
      color: #f87171;
      opacity: 0;
      transition: opacity 0.15s ease;
    }
    
    .card:hover .remove-btn { opacity: 1; }
    
    .card input, .card textarea { margin-bottom: 8px; }
    .card input:last-child, .card textarea:last-child { margin-bottom: 0; }
    
    .add-btn {
      width: 100%;
      justify-content: center;
      margin-top: 10px;
      border-style: dashed;
    }
    
    /* Photo Upload */
    .photo-upload {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 16px;
    }
    
    .photo-preview {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      border: 2px dashed var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      cursor: pointer;
      transition: border-color 0.15s ease;
    }
    
    .photo-preview:hover { border-color: var(--accent); }
    .photo-preview img { width: 100%; height: 100%; object-fit: cover; }
    .photo-preview span { font-size: 24px; opacity: 0.3; }
    
    /* Color Picker */
    .color-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .color-btn {
      width: 100%;
      height: 32px;
      padding: 0;
      border-radius: 6px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    
    .color-btn.active { border-color: white; box-shadow: 0 0 0 2px var(--bg-primary); }
    
    input[type="color"] {
      width: 100%;
      height: 32px;
      padding: 2px;
      cursor: pointer;
    }
    
    /* Slider */
    input[type="range"] {
      -webkit-appearance: none;
      background: rgba(255,255,255,0.1);
      height: 6px;
      border-radius: 3px;
      margin: 10px 0;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--accent);
      border-radius: 50%;
      cursor: pointer;
    }
    
    /* Toggle */
    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
    }
    
    .toggle-row span { font-size: 13px; }
    
    .toggle {
      position: relative;
      width: 44px;
      height: 24px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    
    .toggle.active { background: var(--accent); }
    
    .toggle::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.2s ease;
    }
    
    .toggle.active::after { transform: translateX(20px); }
    
    /* Preview Area */
    .preview-area {
      flex: 1;
      background: #18181b;
      overflow-y: auto;
      padding: 40px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    
  /* Resume Preview */
  .resume {
  display: block;
  width: 210mm;
  min-height: 297mm;
  padding: 15mm;
  background: white;
  color: #000;
  transform: scale(0.6);
  transform-origin: top center;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  font-family: system-ui, -apple-system, sans-serif;
  line-height: 1.5;
  box-sizing: border-box;
  }
  
  .resume * {
  box-sizing: border-box;
  }
  
  .resume h1, .resume h2, .resume h3, .resume h4, .resume p {
  margin: 0;
  padding: 0;
  }
  
  .resume aside {
  display: block;
  }
  
  .resume main {
  display: block !important;
  }
  
  .resume main > * {
  display: block !important;
  width: 100% !important;
  }
  
  .resume p {
  margin: 0;
  }
  
  /* Print Styles */
    @media print {
      header, .sidebar, .sidebar-right { display: none !important; }
      main { display: block !important; }
      .preview-area { 
        padding: 0 !important; 
        background: white !important;
        overflow: visible !important;
      }
      .resume { 
        transform: none !important; 
        box-shadow: none !important;
        width: 100% !important;
        margin: 0 !important;
      }
    }
    
    /* Responsive */
    @media (max-width: 1200px) {
      .sidebar { width: 300px; }
      .sidebar-right { width: 240px; }
    }
    
    /* Hidden file inputs */
    input[type="file"] { display: none; }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <div class="logo-icon">ARB</div>
      <span>Design Studio Pro</span>
    </div>
    <div class="header-actions">
      <button onclick="saveToStorage()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        Save
      </button>
      <button onclick="exportJson()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
        Export
      </button>
      <button onclick="document.getElementById('jsonInput').click()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        Import
      </button>
      <input type="file" id="jsonInput" accept=".json" onchange="importJson(event)">
      <button class="primary" onclick="window.print()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        PDF
      </button>
    </div>
  </header>

  <main>
    <aside class="sidebar">
      <div class="tabs">
        <button class="tab active" onclick="switchTab('personal')">&#128100;</button>
        <button class="tab" onclick="switchTab('experience')">&#128188;</button>
        <button class="tab" onclick="switchTab('education')">&#127891;</button>
        <button class="tab" onclick="switchTab('extra')">&#127942;</button>
      </div>

      <!-- Personal Tab -->
      <div id="tab-personal" class="tab-content active">
        <div class="section-header">Personal Info</div>
        
        <div class="photo-upload">
          <div class="photo-preview" onclick="document.getElementById('photoInput').click()">
            <span id="photoPlaceholder">&#128100;</span>
            <img id="photoImg" style="display:none;">
          </div>
          <button onclick="document.getElementById('photoInput').click()" style="flex:1;">Upload Photo</button>
          <input type="file" id="photoInput" accept="image/*" onchange="uploadPhoto(event)">
        </div>

        <input type="text" id="name" placeholder="Full Name" oninput="updateData('name', this.value)">
        <input type="text" id="role" placeholder="Job Title" oninput="updateData('role', this.value)">

        <div class="section-header">Contact</div>
        <div class="grid-2">
          <input type="email" id="email" placeholder="Email" oninput="updateData('email', this.value)">
          <input type="tel" id="phone" placeholder="Phone" oninput="updateData('phone', this.value)">
        </div>
        <div class="grid-2">
          <input type="text" id="location" placeholder="Location" oninput="updateData('location', this.value)">
          <input type="text" id="linkedin" placeholder="LinkedIn" oninput="updateData('linkedin', this.value)">
        </div>
        <input type="text" id="website" placeholder="Website" oninput="updateData('website', this.value)">

        <div class="section-header">Summary</div>
        <textarea id="summary" placeholder="Professional summary..." rows="4" oninput="updateData('summary', this.value)"></textarea>

        <div class="section-header">Skills</div>
        <input type="text" id="skills" placeholder="Skills (comma separated)" oninput="updateSkills(this.value)">
      </div>

      <!-- Experience Tab -->
      <div id="tab-experience" class="tab-content">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div class="section-header" style="margin:0;">Experience</div>
          <button onclick="addExperience()">+ Add</button>
        </div>
        <div id="experienceList"></div>
      </div>

      <!-- Education Tab -->
      <div id="tab-education" class="tab-content">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div class="section-header" style="margin:0;">Education</div>
          <button onclick="addEducation()">+ Add</button>
        </div>
        <div id="educationList"></div>
      </div>

      <!-- Extra Tab -->
      <div id="tab-extra" class="tab-content">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div class="section-header" style="margin:0;">Projects</div>
          <button onclick="addProject()">+ Add</button>
        </div>
        <div id="projectsList"></div>

        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:24px;">
          <div class="section-header" style="margin:0;">Custom Sections</div>
          <button onclick="addCustom()">+ Add</button>
        </div>
        <div id="customList"></div>
      </div>
    </aside>

    <section class="preview-area">
      <div class="resume" id="resumePreview"></div>
    </section>

    <aside class="sidebar sidebar-right">
      <div class="section-header">Template</div>
      <select id="template" onchange="updateData('template', this.value)">
        <option value="modern">Modern Professional</option>
        <option value="minimal">Minimal Centered</option>
        <option value="classic">Classic Corporate</option>
        <option value="creative">Creative Bold</option>
        <option value="compact">Compact Dense</option>
      </select>

      <div class="section-header">Theme Color</div>
      <div class="color-grid" id="colorGrid"></div>
      <input type="color" id="customColor" onchange="updateData('color', this.value)">

      <div class="section-header">Font Family</div>
      <select id="fontFamily" onchange="updateData('fontFamily', this.value)">
        <option value="system-ui, -apple-system, sans-serif">System Default</option>
        <option value="Georgia, Cambria, serif">Georgia (Serif)</option>
        <option value="Palatino, 'Palatino Linotype', serif">Palatino (Serif)</option>
        <option value="Arial, Helvetica, sans-serif">Arial (Sans)</option>
        <option value="'Trebuchet MS', sans-serif">Trebuchet (Sans)</option>
        <option value="'Courier New', Courier, monospace">Courier (Mono)</option>
      </select>

      <div class="section-header">Font Size: <span id="fontSizeLabel">12</span>px</div>
      <input type="range" id="fontSize" min="10" max="16" step="1" value="12" oninput="updateFontSize(this.value)">

      <div class="section-header">Visibility</div>
      <div class="toggle-row">
        <span>Show Photo</span>
        <div class="toggle" id="togglePhoto" onclick="toggleOption('showPhoto')"></div>
      </div>
      <div class="toggle-row">
        <span>Show Summary</span>
        <div class="toggle active" id="toggleSummary" onclick="toggleOption('showSummary')"></div>
      </div>
      <div class="toggle-row">
        <span>Show Projects</span>
        <div class="toggle active" id="toggleProjects" onclick="toggleOption('showProjects')"></div>
      </div>

      <div style="margin-top:30px; padding-top:20px; border-top:1px solid var(--border);">
        <button class="danger" style="width:100%; justify-content:center;" onclick="resetData()">Reset to Defaults</button>
      </div>
    </aside>
  </main>

  <script>
    // Default data
    const defaultData = {
      name: "John Doe",
      role: "Senior Software Engineer",
      email: "john.doe@email.com",
      phone: "+1 (555) 123-4567",
      location: "San Francisco, CA",
      linkedin: "linkedin.com/in/johndoe",
      website: "johndoe.dev",
      summary: "Passionate software engineer with 5+ years of experience building scalable web applications. Specialized in React, Node.js, and cloud technologies.",
      skills: ["JavaScript", "TypeScript", "React", "Node.js", "Python", "AWS"],
      experience: [
        { id: "1", title: "Senior Developer", company: "Tech Corp", year: "2022 - Present", description: "Led development of core platform features, improving performance by 40%." },
        { id: "2", title: "Software Engineer", company: "StartupXYZ", year: "2019 - 2022", description: "Built and maintained microservices architecture serving 1M+ users." }
      ],
      education: [
        { id: "1", degree: "B.S. Computer Science", school: "Stanford University", year: "2019" }
      ],
      projects: [
        { id: "1", name: "OpenSource CLI Tool", tech: "Go, Cobra", description: "Developer productivity tool with 2K+ GitHub stars", link: "github.com/project" }
      ],
      custom: [],
      photo: "",
      color: "#2563eb",
      fontSize: 12,
      fontFamily: "system-ui, -apple-system, sans-serif",
      template: "modern",
      showPhoto: false,
      showSummary: true,
      showProjects: true
    };

    const colors = ["#2563eb", "#16a34a", "#dc2626", "#7c3aed", "#ea580c", "#0891b2", "#000000"];
    
    let data = JSON.parse(JSON.stringify(defaultData));

    // Initialize
    function init() {
      const saved = localStorage.getItem("resumeData");
      if (saved) {
        try {
          data = { ...defaultData, ...JSON.parse(saved) };
        } catch(e) {}
      }
      populateForm();
      renderColorGrid();
      renderLists();
      renderPreview();
    }

    function populateForm() {
      document.getElementById('name').value = data.name;
      document.getElementById('role').value = data.role;
      document.getElementById('email').value = data.email;
      document.getElementById('phone').value = data.phone;
      document.getElementById('location').value = data.location;
      document.getElementById('linkedin').value = data.linkedin;
      document.getElementById('website').value = data.website;
      document.getElementById('summary').value = data.summary;
      document.getElementById('skills').value = data.skills.join(", ");
      document.getElementById('template').value = data.template;
      document.getElementById('fontFamily').value = data.fontFamily;
      document.getElementById('fontSize').value = data.fontSize;
      document.getElementById('fontSizeLabel').textContent = data.fontSize;
      document.getElementById('customColor').value = data.color;
      
      document.getElementById('togglePhoto').classList.toggle('active', data.showPhoto);
      document.getElementById('toggleSummary').classList.toggle('active', data.showSummary);
      document.getElementById('toggleProjects').classList.toggle('active', data.showProjects);
      
      if (data.photo) {
        document.getElementById('photoImg').src = data.photo;
        document.getElementById('photoImg').style.display = 'block';
        document.getElementById('photoPlaceholder').style.display = 'none';
      }
    }

    function renderColorGrid() {
      const grid = document.getElementById('colorGrid');
      grid.innerHTML = colors.map(c => 
        `<button class="color-btn ${data.color === c ? 'active' : ''}" 
                 style="background:${c}; ${c === '#000000' ? 'border:1px solid rgba(255,255,255,0.2)' : ''}" 
                 onclick="selectColor('${c}')"></button>`
      ).join('');
    }

    function selectColor(c) {
      data.color = c;
      document.getElementById('customColor').value = c;
      renderColorGrid();
      renderPreview();
    }

    function updateData(key, value) {
      data[key] = value;
      if (key === 'fontSize') document.getElementById('fontSizeLabel').textContent = value;
      if (key === 'color') renderColorGrid();
      renderPreview();
    }

    function updateSkills(value) {
      data.skills = value.split(",").map(s => s.trim()).filter(Boolean);
      renderPreview();
    }

    function updateFontSize(value) {
      data.fontSize = parseInt(value);
      document.getElementById('fontSizeLabel').textContent = value;
      renderPreview();
    }

    function toggleOption(key) {
      data[key] = !data[key];
      document.getElementById('toggle' + key.charAt(4).toUpperCase() + key.slice(5)).classList.toggle('active', data[key]);
      renderPreview();
    }

    function switchTab(name) {
      document.querySelectorAll('.tab').forEach((t, i) => {
        t.classList.toggle('active', ['personal', 'experience', 'education', 'extra'][i] === name);
      });
      document.querySelectorAll('.tab-content').forEach(c => {
        c.classList.toggle('active', c.id === 'tab-' + name);
      });
    }

    function generateId() {
      return Math.random().toString(36).substring(2, 9);
    }

    // Experience
    function addExperience() {
      data.experience.push({ id: generateId(), title: "Role", company: "Company", year: "Year", description: "Description..." });
      renderLists();
      renderPreview();
    }

    function updateExperience(index, field, value) {
      data.experience[index][field] = value;
      renderPreview();
    }

    function removeExperience(index) {
      data.experience.splice(index, 1);
      renderLists();
      renderPreview();
    }

    // Education
    function addEducation() {
      data.education.push({ id: generateId(), degree: "Degree", school: "School", year: "Year" });
      renderLists();
      renderPreview();
    }

    function updateEducation(index, field, value) {
      data.education[index][field] = value;
      renderPreview();
    }

    function removeEducation(index) {
      data.education.splice(index, 1);
      renderLists();
      renderPreview();
    }

    // Projects
    function addProject() {
      data.projects.push({ id: generateId(), name: "Project Name", tech: "Tech Stack", description: "Description...", link: "" });
      renderLists();
      renderPreview();
    }

    function updateProject(index, field, value) {
      data.projects[index][field] = value;
      renderPreview();
    }

    function removeProject(index) {
      data.projects.splice(index, 1);
      renderLists();
      renderPreview();
    }

    // Custom Sections
    function addCustom() {
      data.custom.push({ id: generateId(), title: "Section Title", content: "Content here..." });
      renderLists();
      renderPreview();
    }

    function updateCustom(index, field, value) {
      data.custom[index][field] = value;
      renderPreview();
    }

    function removeCustom(index) {
      data.custom.splice(index, 1);
      renderLists();
      renderPreview();
    }

    function renderLists() {
      // Experience
      document.getElementById('experienceList').innerHTML = data.experience.map((e, i) => `
        <div class="card" draggable="true" ondragstart="dragStart(event, 'experience', ${i})" ondragover="dragOver(event)" ondrop="drop(event, 'experience', ${i})">
          <button class="remove-btn" onclick="removeExperience(${i})">&#10005;</button>
          <input type="text" value="${escapeHtml(e.title)}" placeholder="Job Title" oninput="updateExperience(${i}, 'title', this.value)">
          <input type="text" value="${escapeHtml(e.company)}" placeholder="Company" oninput="updateExperience(${i}, 'company', this.value)">
          <input type="text" value="${escapeHtml(e.year)}" placeholder="Year" oninput="updateExperience(${i}, 'year', this.value)">
          <textarea placeholder="Description" oninput="updateExperience(${i}, 'description', this.value)">${escapeHtml(e.description)}</textarea>
        </div>
      `).join('');

      // Education
      document.getElementById('educationList').innerHTML = data.education.map((e, i) => `
        <div class="card" draggable="true" ondragstart="dragStart(event, 'education', ${i})" ondragover="dragOver(event)" ondrop="drop(event, 'education', ${i})">
          <button class="remove-btn" onclick="removeEducation(${i})">&#10005;</button>
          <input type="text" value="${escapeHtml(e.degree)}" placeholder="Degree" oninput="updateEducation(${i}, 'degree', this.value)">
          <input type="text" value="${escapeHtml(e.school)}" placeholder="School" oninput="updateEducation(${i}, 'school', this.value)">
          <input type="text" value="${escapeHtml(e.year)}" placeholder="Year" oninput="updateEducation(${i}, 'year', this.value)">
        </div>
      `).join('');

      // Projects
      document.getElementById('projectsList').innerHTML = data.projects.map((p, i) => `
        <div class="card" draggable="true" ondragstart="dragStart(event, 'projects', ${i})" ondragover="dragOver(event)" ondrop="drop(event, 'projects', ${i})">
          <button class="remove-btn" onclick="removeProject(${i})">&#10005;</button>
          <input type="text" value="${escapeHtml(p.name)}" placeholder="Project Name" oninput="updateProject(${i}, 'name', this.value)">
          <input type="text" value="${escapeHtml(p.tech)}" placeholder="Tech Stack" oninput="updateProject(${i}, 'tech', this.value)">
          <textarea placeholder="Description" oninput="updateProject(${i}, 'description', this.value)">${escapeHtml(p.description)}</textarea>
          <input type="text" value="${escapeHtml(p.link)}" placeholder="Link (optional)" oninput="updateProject(${i}, 'link', this.value)">
        </div>
      `).join('');

      // Custom
      document.getElementById('customList').innerHTML = data.custom.map((c, i) => `
        <div class="card" style="border-color:rgba(34,197,94,0.2);" draggable="true" ondragstart="dragStart(event, 'custom', ${i})" ondragover="dragOver(event)" ondrop="drop(event, 'custom', ${i})">
          <button class="remove-btn" onclick="removeCustom(${i})">&#10005;</button>
          <input type="text" value="${escapeHtml(c.title)}" placeholder="Section Title" oninput="updateCustom(${i}, 'title', this.value)">
          <textarea placeholder="Content" oninput="updateCustom(${i}, 'content', this.value)">${escapeHtml(c.content)}</textarea>
        </div>
      `).join('');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Drag and Drop
    let dragData = null;

    function dragStart(e, type, index) {
      dragData = { type, index };
      e.target.classList.add('dragging');
    }

    function dragOver(e) {
      e.preventDefault();
    }

    function drop(e, type, targetIndex) {
      e.preventDefault();
      document.querySelectorAll('.dragging').forEach(el => el.classList.remove('dragging'));
      
      if (!dragData || dragData.type !== type) return;
      
      const items = data[type];
      const [removed] = items.splice(dragData.index, 1);
      items.splice(targetIndex, 0, removed);
      
      dragData = null;
      renderLists();
      renderPreview();
    }

    // Photo Upload
    function uploadPhoto(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(ev) {
          data.photo = ev.target.result;
          data.showPhoto = true;
          document.getElementById('photoImg').src = data.photo;
          document.getElementById('photoImg').style.display = 'block';
          document.getElementById('photoPlaceholder').style.display = 'none';
          document.getElementById('togglePhoto').classList.add('active');
          renderPreview();
        };
        reader.readAsDataURL(file);
      }
    }

    // Save/Export/Import
    function saveToStorage() {
      localStorage.setItem("resumeData", JSON.stringify(data));
      alert("Resume saved!");
    }

    function exportJson() {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "resume-data.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function importJson(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(ev) {
          try {
            const imported = JSON.parse(ev.target.result);
            data = { ...defaultData, ...imported };
            populateForm();
            renderLists();
            renderPreview();
          } catch(err) {
            alert("Invalid JSON file");
          }
        };
        reader.readAsText(file);
      }
    }

    function resetData() {
      if (confirm("Reset all data to defaults?")) {
        data = JSON.parse(JSON.stringify(defaultData));
        localStorage.removeItem("resumeData");
        document.getElementById('photoImg').style.display = 'none';
        document.getElementById('photoPlaceholder').style.display = 'block';
        populateForm();
        renderLists();
        renderPreview();
      }
    }

    // Render Preview
    function renderPreview() {
      const fs = data.fontSize + 'px';
      const col = data.color;
      
      const contactItems = [
        data.email && { icon: "&#9993;", text: data.email },
        data.phone && { icon: "&#9742;", text: data.phone },
        data.location && { icon: "&#128205;", text: data.location },
        data.linkedin && { icon: "in", text: data.linkedin },
        data.website && { icon: "&#127760;", text: data.website }
      ].filter(Boolean);

      const skillsHtml = `<div style="display:flex;flex-wrap:wrap;gap:4px;margin-top:8px;">
        ${data.skills.map(s => `<span style="background:${col}15;color:${col};padding:2px 8px;border-radius:4px;font-size:calc(${fs} - 3px);font-weight:700;border:1px solid ${col}30;">${s.toUpperCase()}</span>`).join('')}
      </div>`;

      const experienceHtml = `<div style="display:block;">${data.experience.map(e => `
        <div style="display:block;margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;font-weight:bold;font-size:${fs};">
            <span>${escapeHtml(e.title)}</span>
            <span style="color:${col};">${escapeHtml(e.year)}</span>
          </div>
          <div style="font-size:calc(${fs} - 2px);color:${col};margin-bottom:2px;">${escapeHtml(e.company)}</div>
          <p style="font-size:calc(${fs} - 1px);line-height:1.4;color:#333;margin:0;">${escapeHtml(e.description)}</p>
        </div>
      `).join('')}</div>`;

      const educationHtml = `<div style="display:block;">${data.education.map(e => `
        <div style="display:block;margin-bottom:8px;">
          <p style="font-weight:bold;font-size:${fs};margin:0;">${escapeHtml(e.degree)}</p>
          <p style="font-size:calc(${fs} - 2px);color:${col};margin:0;">${escapeHtml(e.school)} | ${escapeHtml(e.year)}</p>
        </div>
      `).join('')}</div>`;

      const projectsHtml = data.showProjects && data.projects.length > 0 ? `
        <div style="margin-top:15px;">
          <h2 style="font-size:12px;font-weight:900;border-bottom:2px solid ${col};color:${col};padding-bottom:5px;margin-bottom:10px;text-transform:uppercase;">Projects</h2>
          ${data.projects.map(p => `
            <div style="margin-bottom:10px;">
              <div style="display:flex;justify-content:space-between;font-weight:bold;font-size:${fs};">
                <span>${escapeHtml(p.name)}</span>
                <span style="color:${col};font-size:calc(${fs} - 2px);">${escapeHtml(p.tech)}</span>
              </div>
              <p style="font-size:calc(${fs} - 1px);line-height:1.4;color:#333;margin:0;">${escapeHtml(p.description)}</p>
              ${p.link ? `<p style="font-size:calc(${fs} - 2px);color:${col};margin:0;">${escapeHtml(p.link)}</p>` : ''}
            </div>
          `).join('')}
        </div>
      ` : '';

      const customHtml = data.custom.map(c => `
        <div style="margin-top:15px;">
          <h2 style="font-size:12px;font-weight:900;border-bottom:1px solid ${col};color:${col};padding-bottom:3px;margin-bottom:8px;text-transform:uppercase;">${escapeHtml(c.title)}</h2>
          <p style="font-size:calc(${fs} - 1px);line-height:1.4;margin:0;">${escapeHtml(c.content)}</p>
        </div>
      `).join('');

      const summarySection = data.showSummary && data.summary ? `
        <div style="margin-bottom:15px;">
          <h2 style="font-size:12px;font-weight:900;border-bottom:2px solid ${col};color:${col};padding-bottom:5px;margin-bottom:10px;text-transform:uppercase;">Summary</h2>
          <p style="font-size:calc(${fs} - 1px);line-height:1.5;color:#333;margin:0;">${escapeHtml(data.summary)}</p>
        </div>
      ` : '';

      const photoElement = data.showPhoto && data.photo ? 
        `<img src="${data.photo}" alt="Profile" style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid ${col};">` : '';

      const contactLine = `<div style="display:flex;flex-wrap:wrap;gap:12px;font-size:calc(${fs} - 2px);color:#666;margin-top:8px;">
        ${contactItems.map(c => `<span>${c.icon} ${escapeHtml(c.text)}</span>`).join('')}
      </div>`;

      let html = '';

      if (data.template === 'modern') {
        html = `
          <div style="display:grid;grid-template-columns:1fr 2fr;gap:30px;">
            <aside style="border-right:1px solid #eee;padding-right:20px;">
              ${photoElement}
              <h1 style="font-size:24px;font-weight:900;color:${col};margin:10px 0 0 0;">${escapeHtml(data.name)}</h1>
              <p style="font-weight:bold;font-size:14px;margin-bottom:20px;opacity:0.7;">${escapeHtml(data.role)}</p>
              <h4 style="font-size:10px;font-weight:900;letter-spacing:1px;margin-bottom:10px;color:${col};">CONTACT</h4>
              <div style="font-size:calc(${fs} - 2px);color:#444;line-height:1.8;">
                ${contactItems.map(c => `<div>${escapeHtml(c.text)}</div>`).join('')}
              </div>
              <h4 style="font-size:10px;font-weight:900;letter-spacing:1px;margin:20px 0 10px;color:${col};">SKILLS</h4>
              ${skillsHtml}
            </aside>
            <main>
              ${summarySection}
              <h2 style="font-size:12px;font-weight:900;border-bottom:2px solid ${col};color:${col};padding-bottom:5px;margin-bottom:15px;">EXPERIENCE</h2>
              ${experienceHtml}
              <h2 style="font-size:12px;font-weight:900;border-bottom:2px solid ${col};color:${col};padding-bottom:5px;margin-bottom:15px;margin-top:20px;">EDUCATION</h2>
              ${educationHtml}
              ${projectsHtml}
              ${customHtml}
            </main>
          </div>
        `;
      } else if (data.template === 'minimal') {
        html = `
          <div style="text-align:center;margin-bottom:30px;border-bottom:1px solid #eee;padding-bottom:20px;">
            ${data.showPhoto && data.photo ? `<img src="${data.photo}" alt="Profile" style="width:100px;height:100px;border-radius:50%;object-fit:cover;margin:0 auto 15px;display:block;border:3px solid ${col};">` : ''}
            <h1 style="font-size:32px;font-weight:900;margin:0;">${escapeHtml(data.name)}</h1>
            <p style="color:${col};font-weight:700;font-size:16px;margin:5px 0 0;">${escapeHtml(data.role)}</p>
            ${contactLine}
          </div>
          ${summarySection}
          <div style="margin-bottom:20px;">
            <h2 style="font-size:12px;font-weight:900;color:${col};margin-bottom:10px;text-align:center;letter-spacing:2px;">SKILLS</h2>
            <div style="display:flex;justify-content:center;">${skillsHtml}</div>
          </div>
          <h2 style="font-size:12px;font-weight:900;border-bottom:1px solid #ddd;margin-bottom:10px;text-transform:uppercase;">Experience</h2>
          ${experienceHtml}
          <h2 style="font-size:12px;font-weight:900;border-bottom:1px solid #ddd;margin-bottom:10px;text-transform:uppercase;margin-top:15px;">Education</h2>
          ${educationHtml}
          ${projectsHtml}
          ${customHtml}
        `;
      } else if (data.template === 'classic') {
        html = `
          <div style="padding:20px;background:${col}08;border:1px solid ${col}30;margin-bottom:25px;display:flex;align-items:center;gap:20px;">
            ${photoElement}
            <div>
              <h1 style="font-size:28px;font-weight:900;color:#111;margin:0;">${escapeHtml(data.name)}</h1>
              <p style="font-weight:bold;color:${col};margin:5px 0 0;">${escapeHtml(data.role)}</p>
              ${contactLine}
            </div>
          </div>
          ${summarySection}
          <div style="margin-bottom:20px;">
            <h3 style="font-size:11px;font-weight:900;color:${col};">SKILLS</h3>
            ${skillsHtml}
          </div>
          <h3 style="font-size:11px;font-weight:900;color:${col};margin-top:20px;">PROFESSIONAL HISTORY</h3>
          ${experienceHtml}
          <h3 style="font-size:11px;font-weight:900;color:${col};margin-top:20px;">EDUCATION</h3>
          ${educationHtml}
          ${projectsHtml}
          ${customHtml}
        `;
      } else if (data.template === 'creative') {
        html = `
          <div style="background:${col};color:white;padding:30px;margin-bottom:25px;display:flex;align-items:center;gap:25px;">
            ${data.showPhoto && data.photo ? `<img src="${data.photo}" alt="Profile" style="width:90px;height:90px;border-radius:50%;object-fit:cover;border:4px solid white;">` : ''}
            <div>
              <h1 style="font-size:32px;font-weight:900;margin:0;">${escapeHtml(data.name)}</h1>
              <p style="font-size:18px;margin:5px 0 0;opacity:0.9;">${escapeHtml(data.role)}</p>
            </div>
          </div>
          <div style="display:flex;flex-wrap:wrap;gap:15px;margin-bottom:20px;font-size:calc(${fs} - 1px);">
            ${contactItems.map(c => `<span style="background:${col}15;color:${col};padding:5px 12px;border-radius:20px;">${c.icon} ${escapeHtml(c.text)}</span>`).join('')}
          </div>
          ${summarySection}
          <div style="margin-bottom:20px;">
            <h2 style="font-size:14px;font-weight:900;color:${col};margin-bottom:10px;">&#9889; SKILLS</h2>
            ${skillsHtml}
          </div>
          <h2 style="font-size:14px;font-weight:900;color:${col};margin-bottom:10px;">&#128188; EXPERIENCE</h2>
          ${experienceHtml}
          <h2 style="font-size:14px;font-weight:900;color:${col};margin-bottom:10px;margin-top:20px;">&#127891; EDUCATION</h2>
          ${educationHtml}
          ${projectsHtml}
          ${customHtml}
        `;
      } else if (data.template === 'compact') {
        html = `
          <div style="display:flex;justify-content:space-between;align-items:flex-start;border-bottom:2px solid ${col};padding-bottom:15px;margin-bottom:15px;">
            <div style="display:flex;gap:15px;align-items:center;">
              ${photoElement}
              <div>
                <h1 style="font-size:22px;font-weight:900;margin:0;color:${col};">${escapeHtml(data.name)}</h1>
                <p style="font-size:13px;font-weight:600;margin:0;">${escapeHtml(data.role)}</p>
              </div>
            </div>
            <div style="text-align:right;font-size:calc(${fs} - 2px);color:#555;line-height:1.6;">
              ${contactItems.slice(0, 3).map(c => `<div>${escapeHtml(c.text)}</div>`).join('')}
            </div>
          </div>
          ${data.showSummary && data.summary ? `<p style="font-size:calc(${fs} - 1px);line-height:1.4;color:#333;margin-bottom:12px;font-style:italic;">${escapeHtml(data.summary)}</p>` : ''}
          <div style="display:flex;gap:5px;flex-wrap:wrap;margin-bottom:12px;">
            ${data.skills.map(s => `<span style="background:${col};color:white;padding:2px 6px;border-radius:3px;font-size:9px;font-weight:700;">${escapeHtml(s)}</span>`).join('')}
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
            <div>
              <h3 style="font-size:10px;font-weight:900;color:${col};border-bottom:1px solid ${col};padding-bottom:3px;margin-bottom:8px;">EXPERIENCE</h3>
              ${data.experience.map(e => `
                <div style="margin-bottom:8px;">
                  <div style="font-weight:bold;font-size:calc(${fs} - 1px);">${escapeHtml(e.title)}</div>
                  <div style="font-size:calc(${fs} - 2px);color:${col};">${escapeHtml(e.company)} &bull; ${escapeHtml(e.year)}</div>
                  <p style="font-size:calc(${fs} - 2px);color:#555;margin:2px 0 0;line-height:1.3;">${escapeHtml(e.description)}</p>
                </div>
              `).join('')}
            </div>
            <div>
              <h3 style="font-size:10px;font-weight:900;color:${col};border-bottom:1px solid ${col};padding-bottom:3px;margin-bottom:8px;">EDUCATION</h3>
              ${educationHtml}
              ${data.showProjects && data.projects.length > 0 ? `
                <h3 style="font-size:10px;font-weight:900;color:${col};border-bottom:1px solid ${col};padding-bottom:3px;margin-bottom:8px;margin-top:12px;">PROJECTS</h3>
                ${data.projects.map(p => `
                  <div style="margin-bottom:6px;">
                    <div style="font-weight:bold;font-size:calc(${fs} - 1px);">${escapeHtml(p.name)}</div>
                    <p style="font-size:calc(${fs} - 2px);color:#555;margin:0;">${escapeHtml(p.description)}</p>
                  </div>
                `).join('')}
              ` : ''}
            </div>
          </div>
          ${customHtml}
        `;
      }

      document.getElementById('resumePreview').innerHTML = `<div style="display:block;width:100%;">${html}</div>`;
      document.getElementById('resumePreview').style.fontFamily = data.fontFamily;
    }

    // Initialize on load
    init();
  </script>
</body>
</html>
